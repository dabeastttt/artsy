<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gooning Gallery</title>
  <link rel="stylesheet" href="../styles/style.css" />
  <style>
  /* Base body */
body {
  background: #000; 
  color: #ff4fd8;  
  font-family: 'Courier New', monospace;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  margin: 0;
  padding: 20px 0;
  min-height: 100vh;
}

/* Terminal wrapper */
.terminal {
  width: 95%;
  max-width: 1200px;
  max-height: 90vh;
  padding: 22px;
  border: 2px solid #ff4fd8; 
  border-radius: 8px;
  box-shadow: 0 0 15px #ff4fd8; 
  overflow: auto;
  background: #000;
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 0;
  box-sizing: border-box;
}

/* Header */
.terminal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #111;
  padding: 5px 10px;
  font-weight: bold;
}

.terminal-title {
  font-size: 13px;
  font-weight: bold;
  color: #ff4fd8;
}

.window-controls {
  display: flex;
  gap: 5px;
}

.window-btn {
  width: 20px;
  height: 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  background: #ff4fd8;
  color: #000;
  transition: all 0.2s ease;
}
.window-btn:hover {
  background: #fff;
  color: #ff4fd8;
}

/* Gallery grid */
.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 18px;
  padding: 48px 12px 12px 12px;
  box-sizing: border-box;
  width: 100%;
  align-content: start;
}

.gallery-item {
  background: #111;
  border: 2px solid #ff4fd8;
  border-radius: 6px;
  overflow: hidden;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.gallery-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 0 15px #ff4fd8;
}

.gallery-item img {
  width: 100%;
  height: 180px;
  object-fit: cover;
  display:block;
  border-bottom: 1px solid #ff4fd8;
}

.gallery-caption {
  padding: 10px;
  font-size: 13px;
  font-weight: 600;
  color: #ff4fd8;
  text-align: center;
  background: #111;
  border-top: 1px solid #ff4fd8;
}

.meta-row {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding: 8px 12px;
  border-top: 1px dashed rgba(255,79,216,0.2);
  font-size: 12px;
  color: #888;
  background: #111;
}

/* Footer */
.terminal-footer {
  padding: 10px 18px;
  font-family: 'Courier New', monospace;
  color: #ff4fd8;
  border-top: 1px solid #ff4fd8;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.terminal-footer a { color: #ff4fd8; text-decoration:none; }
.terminal-footer:hover { text-decoration: underline; }

.small-muted { color:#888; font-size:13px; }

/* Bunny floating */
.bunny {
  font-family: monospace;
  white-space: pre;
  text-align: left;
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(0,0,0,0.85);
  border: 1px solid #ff4fd8;
  padding: 6px 8px;
  border-radius: 6px;
  box-shadow: 0 0 10px #ff4fd8;
  font-size: 14px;
  line-height: 1.2;
  z-index: 1000;
}

/* Dev reset button */
.reset-btn {
  font-size: 12px;
  color: #888;
  cursor: pointer;
}
.reset-btn:hover {
  text-decoration: underline;
  color: #ff4fd8;
}

.empty-note {
  grid-column: 1/-1;
  text-align:center;
  color:#888;
  padding: 24px 12px;
}

/* Mobile responsiveness */
@media (max-width: 900px) {
  .gallery {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    padding: 24px 6px 12px 6px;
  }
  .gallery-item img {
    height: 140px;
  }
  .terminal-footer {
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
  }
  .bunny { font-size: 12px; padding: 5px 6px; bottom: 10px; right: 10px; }
}
  </style>
</head>
<body>
  <div class="terminal" role="application" aria-label="gooning gallery terminal">
    <div class="terminal-header">
      <span class="terminal-title">raw.uncensord.gallery.terminal</span>
      <div class="window-controls">
        <button class="window-btn">–</button>
        <button class="window-btn">□</button>
        <button class="window-btn">×</button>
      </div>
    </div>

    <!-- GALLERY -->
    <div class="gallery" id="gallery"></div>

    <div class="terminal-footer">
      <div onclick="window.location.href='index.html'" style="cursor:pointer;">← back to gooner.terminal</div>
      <div class="small-muted">
        All revealed artworks collected in one place |
        <span class="reset-btn" onclick="resetGallery()">reset</span>
      </div>
    </div>
  </div>

  <!-- Floating Bunny -->
  <div class="bunny" id="bunnyBox">
       (｡♥‿♥｡) 
       /( .Y. )\ ~ goonmaxing
         |   |   
  </div>

  <script>
    const galleryEl = document.getElementById("gallery");

    // Render gallery array (server-provided)
    function renderGallery(items) {
      galleryEl.innerHTML = "";
      if (!items || items.length === 0) {
        galleryEl.innerHTML = '<div class="empty-note">No artworks revealed yet. Come back soon.</div>';
        return;
      }
      items.forEach(a => {
        const item = document.createElement("div");
        item.className = "gallery-item";
        const ts = new Date(a.ts || Date.now());
        const human = ts.toLocaleString();
        item.innerHTML = `
          <img src="${a.src}" alt="${a.title}">
          <div class="gallery-caption">${a.title}</div>
          <div class="meta-row">
            <div>Revealed: ${human}</div>
            <div style="opacity:0.8;">#${a.index + 1}</div>
          </div>
        `;
        galleryEl.appendChild(item);
      });
    }

    // Fetch gallery from server
    async function fetchGallery() {
      try {
        const res = await fetch("/api/gallery");
        if (!res.ok) throw new Error("Failed to load gallery");
        const data = await res.json();
        renderGallery(data);
      } catch (err) {
        galleryEl.innerHTML = `<div class="empty-note">Error loading gallery: ${err.message}</div>`;
      }
    }

    // Reset gallery via server reset endpoint
    async function resetGallery() {
      const key = prompt("Enter dev secret to reset gallery and session:");
      if (!key) return;
      try {
        const res = await fetch("/api/reset", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ key })
        });
        const json = await res.json();
        if (res.ok && json.ok) {
          alert("Reset accepted. Re-syncing gallery...");
          setTimeout(fetchGallery, 400);
        } else {
          alert("Reset failed: " + (json && json.error ? json.error : "unknown"));
        }
      } catch (err) {
        alert("Reset request error: " + err.message);
      }
    }

    window.addEventListener("load", () => {
      fetchGallery();
      setInterval(fetchGallery, 8000);
    });

   // Floating bunny cycling
const bunnyFaces = [
 `(｡♥‿♥｡)
 /( .Y. )\\ 
   |   |
 ~ goonmaxing`,

  `(≧◡≦)
 /( UwU )\\ 
   |   |
 ~ pwease`,

  `(◕‿◕)
 /( .O. )\\ 
   |   |
 ~ horny`,

 `(✿◠‿◠)
 /( >.< )\\ 
   |   | 
 ~ edging`,

  `(¬‿¬)
 /( .3. )\\ 
   |   | 
 ~ mogging`
];


    let faceIndex = 0;
    const bunnyBox = document.getElementById('bunnyBox');
    setInterval(() => {
      faceIndex = (faceIndex + 1) % bunnyFaces.length;
      bunnyBox.textContent = bunnyFaces[faceIndex];
    }, 4000);
  </script>
</body>
</html>
